<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠ å¯†è²¨å¹£è½‰æ›å™¨ï½œå³æ™‚åƒ¹æ ¼</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #111;
            color: white;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 900px;
            margin: auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
        }

        /* ä¿®æ”¹ï¼šå›ºå®šåƒ¹æ ¼é¡¯ç¤ºï¼Œå–æ¶ˆæ»¾å‹• */
        .price-banner {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid #333;
        }

        .price-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            text-align: center;
        }

        .price-item {
            background: #222;
            padding: 12px;
            border-radius: 6px;
            border-left: 4px solid #0a84ff;
        }

        .price-symbol {
            font-weight: bold;
            color: #0a84ff;
            font-size: 14px;
        }

        .price-value {
            font-size: 16px;
            margin-top: 5px;
        }

        .card {
            background: #1b1b1b;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        select, input {
            padding: 10px;
            width: 100%;
            margin-top: 10px;
            background: #333;
            border: 1px solid #444;
            border-radius: 5px;
            color: white;
        }

        button {
            width: 100%;
            padding: 12px;
            background: #0a84ff;
            border: none;
            border-radius: 6px;
            color: white;
            font-weight: bold;
            font-size: 16px;
            margin-top: 10px;
            cursor: pointer;
        }

        button:disabled {
            background: #555;
            cursor: not-allowed;
        }

        #result {
            padding: 15px;
            margin-top: 10px;
            background: #222;
            border-radius: 8px;
            text-align: center;
            font-size: 20px;
        }

        .error {
            color: #ff6b6b;
        }

        .success {
            color: #4cd964;
        }

        .loading {
            color: #0a84ff;
        }

        /* è¨ˆç®—æ©Ÿæ¨£å¼ */
        .calculator {
            margin-top: 20px;
        }

        .calculator input {
            font-size: 24px;
            text-align: right;
        }

        .calc-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .calc-btn {
            padding: 18px;
            font-size: 18px;
            background: #333;
        }

        .last-updated {
            text-align: center;
            font-size: 12px;
            color: #888;
            margin-top: 10px;
        }
    </style>
</head>

<body>
<div class="container">
    <h1>åŠ å¯†è²¨å¹£è½‰æ›å™¨</h1>
    
    <!-- ä¿®æ”¹ï¼šå›ºå®šåƒ¹æ ¼é¡¯ç¤ºå€å¡Š -->
    <div class="price-banner">
        <h3 style="margin-top: 0; margin-bottom: 15px;">ğŸ“Š å³æ™‚åŠ å¯†è²¨å¹£åƒ¹æ ¼</h3>
        <div id="priceContainer" class="price-grid">
            <div class="price-item">
                <div class="price-symbol">BTC</div>
                <div class="price-value" id="btc-price">è¼‰å…¥ä¸­...</div>
            </div>
            <div class="price-item">
                <div class="price-symbol">ETH</div>
                <div class="price-value" id="eth-price">è¼‰å…¥ä¸­...</div>
            </div>
            <div class="price-item">
                <div class="price-symbol">SOL</div>
                <div class="price-value" id="sol-price">è¼‰å…¥ä¸­...</div>
            </div>
            <div class="price-item">
                <div class="price-symbol">BNB</div>
                <div class="price-value" id="bnb-price">è¼‰å…¥ä¸­...</div>
            </div>
            <div class="price-item">
                <div class="price-symbol">XRP</div>
                <div class="price-value" id="xrp-price">è¼‰å…¥ä¸­...</div>
            </div>
            <div class="price-item">
                <div class="price-symbol">DOGE</div>
                <div class="price-value" id="doge-price">è¼‰å…¥ä¸­...</div>
            </div>
        </div>
        <div id="lastUpdated" class="last-updated">æœ€å¾Œæ›´æ–°æ™‚é–“: --</div>
    </div>
    
    <!-- è½‰æ›å™¨ -->
    <div class="card">
        <h2>å¹£å€¼è½‰æ›</h2>
        <label>é‡‘é¡</label>
        <input type="number" id="amount" value="1" step="any" min="0.00000001">
        
        <label>å¾</label>
        <select id="fromCurrency">
            <!-- ä¸»è¦åŠ å¯†è²¨å¹£ -->
            <option value="BTC">BTC (Bitcoin)</option>
            <option value="ETH">ETH (Ethereum)</option>
            <option value="SOL">SOL (Solana)</option>
            <option value="BNB">BNB (Binance Coin)</option>
            <option value="ADA">ADA (Cardano)</option>
            <option value="XRP">XRP (Ripple)</option>
            <option value="DOT">DOT (Polkadot)</option>
            
            <!-- å…¶ä»–åŠ å¯†è²¨å¹£ -->
            <option value="DOGE">DOGE (Dogecoin)</option>
            <option value="SHIB">SHIB (Shiba Inu)</option>
            <option value="PEPE">PEPE (Pepe)</option>
            <option value="AVAX">AVAX (Avalanche)</option>
            <option value="MATIC">MATIC (Polygon)</option>
            <option value="LINK">LINK (Chainlink)</option>
            <option value="UNI">UNI (Uniswap)</option>
            
            <!-- ç©©å®šå¹£ -->
            <option value="USDT">USDT (Tether)</option>
            <option value="USDC">USDC (USD Coin)</option>
            <option value="DAI">DAI (Dai)</option>
            
            <!-- æ›´å¤šé¸æ“‡ -->
            <option value="LTC">LTC (Litecoin)</option>
            <option value="ATOM">ATOM (Cosmos)</option>
            <option value="TRX">TRX (Tron)</option>
        </select>
        
        <label>åˆ°</label>
        <select id="toCurrency">
            <!-- æ³•å¹£ -->
            <option value="HKD">HKD (æ¸¯å…ƒ)</option>
            <option value="USD">USD (ç¾å…ƒ)</option>
            <option value="CNY">CNY (äººæ°‘å¹£)</option>
            <option value="TWD">TWD (æ–°å°å¹£)</option>
            <option value="JPY">JPY (æ—¥åœ“)</option>
            <option value="EUR">EUR (æ­å…ƒ)</option>
            <option value="GBP">GBP (è‹±éŠ)</option>
            <option value="KRW">KRW (éŸ“å…ƒ)</option>
            <option value="SGD">SGD (æ–°åŠ å¡å…ƒ)</option>
            <option value="AUD">AUD (æ¾³å…ƒ)</option>
            
            <!-- åŠ å¯†è²¨å¹£ -->
            <option value="BTC">BTC (Bitcoin)</option>
            <option value="ETH">ETH (Ethereum)</option>
            <option value="USDT">USDT (Tether)</option>
            <option value="USDC">USDC (USD Coin)</option>
            <option value="BNB">BNB (Binance Coin)</option>
            <option value="SOL">SOL (Solana)</option>
        </select>
        
        <button id="convertBtn" onclick="convert()">ç«‹å³è½‰æ›</button>
        <div id="result">çµæœæœƒé¡¯ç¤ºåœ¨æ­¤</div>
    </div>
    
    <!-- è¨ˆç®—æ©Ÿ -->
    <div class="card calculator">
        <h2>è¨ˆç®—æ©Ÿ</h2>
        <input type="text" id="calcDisplay" value="0" readonly>
        <div class="calc-grid">
            <button class="calc-btn" onclick="calc('7')">7</button>
            <button class="calc-btn" onclick="calc('8')">8</button>
            <button class="calc-btn" onclick="calc('9')">9</button>
            <button class="calc-btn" onclick="calc('/')">Ã·</button>
            <button class="calc-btn" onclick="calc('4')">4</button>
            <button class="calc-btn" onclick="calc('5')">5</button>
            <button class="calc-btn" onclick="calc('6')">6</button>
            <button class="calc-btn" onclick="calc('*')">Ã—</button>
            <button class="calc-btn" onclick="calc('1')">1</button>
            <button class="calc-btn" onclick="calc('2')">2</button>
            <button class="calc-btn" onclick="calc('3')">3</button>
            <button class="calc-btn" onclick="calc('-')">âˆ’</button>
            <button class="calc-btn" onclick="calc('0')">0</button>
            <button class="calc-btn" onclick="calc('.')">.</button>
            <button class="calc-btn" onclick="equals()">=</button>
            <button class="calc-btn" onclick="calc('+')">+</button>
            <button class="calc-btn" onclick="clearCalc()" style="grid-column: span 4; background:#c62828;">æ¸…é™¤</button>
        </div>
    </div>
</div>

<script>
// =====================
// ğŸ”§ é…ç½®
// =====================
const API_KEY = "CG-uv86KDk1FuMqbYqFmxtuAUL8";
const PRO_API = "https://pro-api.coingecko.com/api/v3";

// æ“´å±•çš„åŠ å¯†è²¨å¹£å°æ‡‰è¡¨
const CRYPTO_IDS = {
    // ä¸»è¦åŠ å¯†è²¨å¹£
    BTC: "bitcoin",
    ETH: "ethereum",
    SOL: "solana",
    BNB: "binancecoin",
    ADA: "cardano",
    XRP: "ripple",
    DOT: "polkadot",
    
    // å…¶ä»–åŠ å¯†è²¨å¹£
    DOGE: "dogecoin",
    SHIB: "shiba-inu",
    PEPE: "pepe",
    AVAX: "avalanche-2",
    MATIC: "matic-network",
    LINK: "chainlink",
    UNI: "uniswap",
    
    // ç©©å®šå¹£
    USDT: "tether",
    USDC: "usd-coin",
    DAI: "dai",
    
    // æ›´å¤šé¸æ“‡
    LTC: "litecoin",
    ATOM: "cosmos",
    TRX: "tron"
};

// è¦é¡¯ç¤ºçš„ç†±é–€å¹£ç¨®
const HOT_CRYPTO = ["BTC", "ETH", "SOL", "BNB", "XRP", "DOGE"];

// =====================
// ğŸ”¥ å³æ™‚åƒ¹æ ¼é¡¯ç¤ºï¼ˆå›ºå®šæ ¼å¼ï¼‰
// =====================
async function loadPrices() {
    try {
        // ç²å–ç†±é–€å¹£ç¨®çš„ ID
        const coinIds = HOT_CRYPTO.map(symbol => CRYPTO_IDS[symbol]).filter(Boolean);
        
        if (coinIds.length === 0) {
            throw new Error("ç„¡æœ‰æ•ˆçš„å¹£ç¨®");
        }
        
        // æ§‹å»º API URL
        let url = `${PRO_API}/simple/price?ids=${coinIds.join(",")}&vs_currencies=usd`;
        
        // å¦‚æœä½¿ç”¨ Pro API ä¸”æœ‰ keyï¼Œæ·»åŠ æŸ¥è©¢åƒæ•¸
        if (API_KEY && PRO_API.includes('pro-api')) {
            url += `&x_cg_pro_api_key=${API_KEY}`;
        }
        
        const res = await fetch(url);
        
        if (!res.ok) {
            throw new Error(`API éŒ¯èª¤: ${res.status} ${res.statusText}`);
        }
        
        const data = await res.json();
        
        // æ›´æ–°æ¯å€‹å¹£ç¨®çš„åƒ¹æ ¼é¡¯ç¤º
        HOT_CRYPTO.forEach(symbol => {
            const coinId = CRYPTO_IDS[symbol];
            const elementId = `${symbol.toLowerCase()}-price`;
            const element = document.getElementById(elementId);
            
            if (element && data[coinId] && data[coinId].usd) {
                const price = data[coinId].usd;
                // æ ¹æ“šåƒ¹æ ¼å¤§å°æ±ºå®šé¡¯ç¤ºæ ¼å¼
                let formattedPrice;
                if (price < 0.01) {
                    formattedPrice = `$${price.toFixed(8)}`;
                } else if (price < 1) {
                    formattedPrice = `$${price.toFixed(4)}`;
                } else if (price < 1000) {
                    formattedPrice = `$${price.toFixed(2)}`;
                } else {
                    formattedPrice = `$${price.toLocaleString('en-US', {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    })}`;
                }
                element.textContent = formattedPrice;
                element.className = "price-value success";
            }
        });
        
        // æ›´æ–°æœ€å¾Œæ›´æ–°æ™‚é–“
        const now = new Date();
        const timeString = now.toLocaleTimeString('zh-HK', {
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
        });
        document.getElementById('lastUpdated').textContent = `æœ€å¾Œæ›´æ–°æ™‚é–“: ${timeString}`;
        
    } catch (error) {
        console.error("è¼‰å…¥åƒ¹æ ¼å¤±æ•—:", error);
        HOT_CRYPTO.forEach(symbol => {
            const elementId = `${symbol.toLowerCase()}-price`;
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = "è¼‰å…¥å¤±æ•—";
                element.className = "price-value error";
            }
        });
        document.getElementById('lastUpdated').textContent = "æ›´æ–°å¤±æ•—";
    }
}

// =====================
// ğŸ”„ å¹£å€¼è½‰æ›
// =====================
async function convert() {
    const amount = parseFloat(document.getElementById("amount").value);
    const from = document.getElementById("fromCurrency").value;
    const to = document.getElementById("toCurrency").value;
    const resultDiv = document.getElementById("result");
    const convertBtn = document.getElementById("convertBtn");
    
    if (isNaN(amount) || amount <= 0) {
        resultDiv.innerHTML = '<span class="error">è«‹è¼¸å…¥æœ‰æ•ˆé‡‘é¡</span>';
        return;
    }
    
    try {
        convertBtn.disabled = true;
        convertBtn.textContent = "è½‰æ›ä¸­...";
        resultDiv.innerHTML = '<span class="loading">å–å¾—åŒ¯ç‡ä¸­...</span>';
        
        // å¦‚æœå…©è€…éƒ½æ˜¯åŠ å¯†è²¨å¹£ï¼Œéœ€è¦é€šé USD ä¸­è½‰
        let result;
        let rate;
        
        if (isCrypto(from) && isCrypto(to)) {
            // åŠ å¯†è²¨å¹£ â†’ åŠ å¯†è²¨å¹£
            const fromRate = await getExchangeRate(from, "USD");
            const toRate = await getExchangeRate(to, "USD");
            rate = fromRate / toRate;
            result = amount * rate;
        } else if (isCrypto(from)) {
            // åŠ å¯†è²¨å¹£ â†’ æ³•å¹£
            rate = await getExchangeRate(from, to);
            result = amount * rate;
        } else if (isCrypto(to)) {
            // æ³•å¹£ â†’ åŠ å¯†è²¨å¹£
            rate = await getExchangeRate(to, from); // æ³¨æ„ï¼šé€™è£¡åéä¾†
            result = amount / rate;
        } else {
            // æ³•å¹£ â†’ æ³•å¹£ï¼ˆæš«æ™‚ä¸æ”¯æŒï¼Œå¯é€šé USD ä¸­è½‰å¯¦ç¾ï¼‰
            throw new Error("æ³•å¹£ä¹‹é–“è½‰æ›æš«ä¸æ”¯æŒ");
        }
        
        // æ ¼å¼åŒ–çµæœ
        const formattedResult = formatNumber(result, to);
        const formattedRate = formatNumber(rate, "rate");
        
        resultDiv.innerHTML = `
            <div class="success">
                <div style="font-size: 24px; margin-bottom: 10px;">
                    ${formatNumber(amount, from)} ${from} = ${formattedResult} ${to}
                </div>
                <small>åŒ¯ç‡: 1 ${from} = ${formattedRate} ${to}</small>
            </div>
        `;
        
    } catch (error) {
        console.error("è½‰æ›å¤±æ•—:", error);
        resultDiv.innerHTML = `<span class="error">è½‰æ›å¤±æ•—: ${error.message}</span>`;
    } finally {
        convertBtn.disabled = false;
        convertBtn.textContent = "ç«‹å³è½‰æ›";
    }
}

// æª¢æŸ¥æ˜¯å¦ç‚ºåŠ å¯†è²¨å¹£
function isCrypto(currency) {
    return CRYPTO_IDS.hasOwnProperty(currency);
}

// ç²å–åŒ¯ç‡
async function getExchangeRate(from, to) {
    const fromId = CRYPTO_IDS[from];
    const toLower = to.toLowerCase();
    
    if (!fromId) {
        throw new Error(`ä¸æ”¯æ´çš„è²¨å¹£: ${from}`);
    }
    
    // æ§‹å»º API URL
    let url = `${PRO_API}/simple/price?ids=${fromId}&vs_currencies=${toLower}`;
    
    if (API_KEY && PRO_API.includes('pro-api')) {
        url += `&x_cg_pro_api_key=${API_KEY}`;
    }
    
    const res = await fetch(url);
    
    if (!res.ok) {
        throw new Error(`API éŒ¯èª¤: ${res.status}`);
    }
    
    const data = await res.json();
    
    if (!data[fromId] || !data[fromId][toLower]) {
        throw new Error(`ç„¡æ³•å–å¾— ${from} åˆ° ${to} çš„åŒ¯ç‡`);
    }
    
    return data[fromId][toLower];
}

// æ ¼å¼åŒ–æ•¸å­—é¡¯ç¤º
function formatNumber(value, currency) {
    if (isNaN(value) || !isFinite(value)) {
        return "NaN";
    }
    
    // æ ¹æ“šè²¨å¹£é¡å‹æ±ºå®šæ ¼å¼
    if (currency === "rate") {
        if (value < 0.000001) {
            return value.toExponential(4);
        } else if (value < 0.01) {
            return value.toFixed(8);
        } else if (value < 1) {
            return value.toFixed(6);
        } else if (value < 1000) {
            return value.toFixed(4);
        } else {
            return value.toLocaleString('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }
    }
    
    // æ ¹æ“šå¯¦éš›è²¨å¹£æ ¼å¼åŒ–
    if (value < 0.01) {
        return value.toFixed(8);
    } else if (value < 1) {
        return value.toFixed(6);
    } else if (value < 10000) {
        return value.toLocaleString('en-US', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 4
        });
    } else {
        return value.toLocaleString('en-US', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });
    }
}

// =====================
// ğŸ”¢ è¨ˆç®—æ©Ÿï¼ˆä¿æŒä¸è®Šï¼‰
// =====================
let calcVal = "0";

function calc(v) {
    if (calcVal === "0" && v !== '.') {
        calcVal = "";
    }
    
    if (v === '.' && calcVal.includes('.')) {
        const lastOperator = Math.max(
            calcVal.lastIndexOf('+'),
            calcVal.lastIndexOf('-'),
            calcVal.lastIndexOf('*'),
            calcVal.lastIndexOf('/')
        );
        
        const lastNumber = calcVal.substring(lastOperator + 1);
        if (lastNumber.includes('.')) {
            return;
        }
    }
    
    calcVal += v;
    updateCalc();
}

function equals() {
    try {
        let expression = calcVal
            .replace(/Ã—/g, '*')
            .replace(/Ã·/g, '/')
            .replace(/âˆ’/g, '-');
        
        const result = eval(expression);
        
        if (isNaN(result) || !isFinite(result)) {
            throw new Error("ç„¡æ•ˆè¨ˆç®—");
        }
        
        calcVal = String(result);
    } catch {
        calcVal = "éŒ¯èª¤";
    }
    updateCalc();
}

function clearCalc() {
    calcVal = "0";
    updateCalc();
}

function updateCalc() {
    document.getElementById("calcDisplay").value = calcVal;
}

// =====================
// ğŸš€ åˆå§‹åŒ–
// =====================
document.addEventListener('DOMContentLoaded', function() {
    // åˆå§‹è¼‰å…¥åƒ¹æ ¼
    loadPrices();
    
    // æ¯30ç§’æ›´æ–°ä¸€æ¬¡åƒ¹æ ¼
    setInterval(loadPrices, 30000);
    
    // æŒ‰ Enter éµè§¸ç™¼è½‰æ›
    document.getElementById('amount').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            convert();
        }
    });
    
    // åˆ‡æ›è²¨å¹£æ™‚è‡ªå‹•è½‰æ›
    document.getElementById('fromCurrency').addEventListener('change', convert);
    document.getElementById('toCurrency').addEventListener('change', convert);
    
    // åˆå§‹è½‰æ›
    setTimeout(convert, 1000);
});
</script>
</body>
</html>
