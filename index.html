<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠ å¯†è²¨å¹£è½‰æ›å™¨ï½œå³æ™‚åƒ¹æ ¼</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #111;
            color: white;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 900px;
            margin: auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
        }

        .price-banner {
            white-space: nowrap;
            overflow: hidden;
            border-bottom: 1px solid #333;
            padding: 10px 0;
            font-size: 16px;
        }

        .scrolling {
            display: inline-block;
            animation: scroll 18s linear infinite;
        }

        @keyframes scroll {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        .card {
            background: #1b1b1b;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        select, input {
            padding: 10px;
            width: 100%;
            margin-top: 10px;
            background: #333;
            border: 1px solid #444;
            border-radius: 5px;
            color: white;
        }

        button {
            width: 100%;
            padding: 12px;
            background: #0a84ff;
            border: none;
            border-radius: 6px;
            color: white;
            font-weight: bold;
            font-size: 16px;
            margin-top: 10px;
            cursor: pointer;
        }

        button:disabled {
            background: #555;
            cursor: not-allowed;
        }

        #result {
            padding: 15px;
            margin-top: 10px;
            background: #222;
            border-radius: 8px;
            text-align: center;
            font-size: 20px;
        }

        .error {
            color: #ff6b6b;
        }

        .success {
            color: #4cd964;
        }

        /* Calculator */
        .calculator {
            margin-top: 20px;
        }

        .calculator input {
            font-size: 24px;
            text-align: right;
        }

        .calc-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .calc-btn {
            padding: 18px;
            font-size: 18px;
            background: #333;
        }

        .loading {
            color: #0a84ff;
        }
    </style>
</head>

<body>
<div class="container">
    <h1>åŠ å¯†è²¨å¹£è½‰æ›å™¨</h1>

    <!-- ğŸ”¥ ç†±é–€å¹£æ»¾å‹•åƒ¹æ ¼ Banner -->
    <div class="price-banner">
        <div id="banner" class="scrolling">è¼‰å…¥å³æ™‚åƒ¹æ ¼...</div>
    </div>

    <!-- ğŸ”¥ è½‰æ›å™¨ -->
    <div class="card">
        <h2>å¹£å€¼è½‰æ›</h2>

        <label>é‡‘é¡</label>
        <input type="number" id="amount" value="1" step="any" min="0.00000001">

        <label>å¾</label>
        <select id="fromCurrency">
            <option>BTC</option>
            <option>ETH</option>
            <option>DOGE</option>
            <option>PEPE</option>
            <option>USDT</option>
            <option>BNB</option>
            <option>XRP</option>
            <option>ADA</option>
            <option>SOL</option>
        </select>

        <label>åˆ°</label>
        <select id="toCurrency">
            <option>HKD</option>
            <option>USD</option>
            <option>CNY</option>
            <option>JPY</option>
            <option>EUR</option>
            <option>TWD</option>
        </select>

        <button id="convertBtn" onclick="convert()">ç«‹å³è½‰æ›</button>

        <div id="result">çµæœæœƒé¡¯ç¤ºåœ¨æ­¤</div>
    </div>

    <!-- ğŸ”¢ è¨ˆç®—æ©Ÿ -->
    <div class="card calculator">
        <h2>è¨ˆç®—æ©Ÿ</h2>
        <input type="text" id="calcDisplay" value="0" readonly>

        <div class="calc-grid">
            <button class="calc-btn" onclick="calc('7')">7</button>
            <button class="calc-btn" onclick="calc('8')">8</button>
            <button class="calc-btn" onclick="calc('9')">9</button>
            <button class="calc-btn" onclick="calc('/')">Ã·</button>

            <button class="calc-btn" onclick="calc('4')">4</button>
            <button class="calc-btn" onclick="calc('5')">5</button>
            <button class="calc-btn" onclick="calc('6')">6</button>
            <button class="calc-btn" onclick="calc('*')">Ã—</button>

            <button class="calc-btn" onclick="calc('1')">1</button>
            <button class="calc-btn" onclick="calc('2')">2</button>
            <button class="calc-btn" onclick="calc('3')">3</button>
            <button class="calc-btn" onclick="calc('-')">âˆ’</button>

            <button class="calc-btn" onclick="calc('0')">0</button>
            <button class="calc-btn" onclick="calc('.')">.</button>
            <button class="calc-btn" onclick="equals()">=</button>
            <button class="calc-btn" onclick="calc('+')">+</button>

            <button class="calc-btn" onclick="clearCalc()" style="grid-column: span 4; background:#c62828;">æ¸…é™¤</button>
        </div>
    </div>
</div>

<script>
// =====================
// ğŸ”¥ é…ç½®
// =====================
const API = "https://api.coingecko.com/api/v3";

const CRYPTO_IDS = {
    BTC: "bitcoin",
    ETH: "ethereum",
    DOGE: "dogecoin",
    PEPE: "pepe",
    USDT: "tether",
    BNB: "binancecoin",
    XRP: "ripple",
    ADA: "cardano",
    SOL: "solana"
};

// =====================
// ğŸ”¥ ç†±é–€å¹£ Banner
// =====================
async function loadBanner() {
    try {
        const coins = ["bitcoin", "ethereum", "dogecoin", "tether", "binancecoin", "solana"];
        const url = `${API}/simple/price?ids=${coins.join(",")}&vs_currencies=usd`;

        const res = await fetch(url);
        
        if (!res.ok) {
            throw new Error(`API éŒ¯èª¤: ${res.status}`);
        }
        
        const data = await res.json();
        
        let text = "";
        for (let id of coins) {
            if (data[id] && data[id].usd) {
                const price = data[id].usd.toLocaleString('en-US', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 8
                });
                const symbol = id.toUpperCase();
                text += `${symbol}: $${price} ï½œ `;
            }
        }
        
        if (text) {
            document.getElementById("banner").innerText = text;
            document.getElementById("banner").className = "scrolling success";
        } else {
            throw new Error("ç„¡æ•¸æ“š");
        }
        
    } catch (error) {
        console.error("è¼‰å…¥åƒ¹æ ¼å¤±æ•—:", error);
        document.getElementById("banner").innerText = "âš ï¸ åƒ¹æ ¼è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œé‡è©¦";
        document.getElementById("banner").className = "scrolling error";
    }
}

// =====================
// ğŸ”¥ å¹£å€¼è½‰æ›
// =====================
async function convert() {
    const amount = parseFloat(document.getElementById("amount").value);
    const from = document.getElementById("fromCurrency").value;
    const to = document.getElementById("toCurrency").value;
    const resultDiv = document.getElementById("result");
    const convertBtn = document.getElementById("convertBtn");
    
    // é©—è­‰è¼¸å…¥
    if (isNaN(amount) || amount <= 0) {
        resultDiv.innerHTML = '<span class="error">è«‹è¼¸å…¥æœ‰æ•ˆé‡‘é¡</span>';
        return;
    }
    
    try {
        // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
        convertBtn.disabled = true;
        convertBtn.textContent = "è½‰æ›ä¸­...";
        resultDiv.innerHTML = '<span class="loading">å–å¾—åŒ¯ç‡ä¸­...</span>';
        
        const coinId = CRYPTO_IDS[from];
        if (!coinId) {
            throw new Error("ä¸æ”¯æ´çš„åŠ å¯†è²¨å¹£");
        }
        
        // æ§‹å»º API URL
        const vsCurrency = to.toLowerCase();
        const url = `${API}/simple/price?ids=${coinId}&vs_currencies=${vsCurrency}`;
        
        // ç™¼é€è«‹æ±‚
        const res = await fetch(url);
        
        if (!res.ok) {
            throw new Error(`API éŒ¯èª¤: ${res.status}`);
        }
        
        const data = await res.json();
        
        // æª¢æŸ¥æ•¸æ“š
        if (!data[coinId] || !data[coinId][vsCurrency]) {
            throw new Error("ç„¡æ³•å–å¾—åŒ¯ç‡");
        }
        
        const rate = data[coinId][vsCurrency];
        const result = amount * rate;
        
        // æ ¼å¼åŒ–çµæœ
        const formattedResult = result.toLocaleString('en-US', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 8
        });
        
        // é¡¯ç¤ºçµæœ
        resultDiv.innerHTML = `
            <div class="success">
                ${amount} ${from} = ${formattedResult} ${to}<br>
                <small>åŒ¯ç‡: 1 ${from} = ${rate.toLocaleString()} ${to}</small>
            </div>
        `;
        
    } catch (error) {
        console.error("è½‰æ›å¤±æ•—:", error);
        resultDiv.innerHTML = `<span class="error">è½‰æ›å¤±æ•—: ${error.message}</span>`;
    } finally {
        // æ¢å¾©æŒ‰éˆ•ç‹€æ…‹
        convertBtn.disabled = false;
        convertBtn.textContent = "ç«‹å³è½‰æ›";
    }
}

// =====================
// ğŸ”¢ è¨ˆç®—æ©Ÿ
// =====================
let calcVal = "0";

function calc(v) {
    if (calcVal === "0" && v !== '.') {
        calcVal = "";
    }
    
    // é˜²æ­¢å¤šå€‹å°æ•¸é»
    if (v === '.' && calcVal.includes('.')) {
        const lastOperator = Math.max(
            calcVal.lastIndexOf('+'),
            calcVal.lastIndexOf('-'),
            calcVal.lastIndexOf('*'),
            calcVal.lastIndexOf('/')
        );
        
        const lastNumber = calcVal.substring(lastOperator + 1);
        if (lastNumber.includes('.')) {
            return;
        }
    }
    
    calcVal += v;
    updateCalc();
}

function equals() {
    try {
        // æ›¿æ›é¡¯ç¤ºç”¨çš„ç¬¦è™Ÿ
        let expression = calcVal
            .replace(/Ã—/g, '*')
            .replace(/Ã·/g, '/')
            .replace(/âˆ’/g, '-');
        
        // å®‰å…¨è¨ˆç®—
        const result = eval(expression);
        
        if (isNaN(result) || !isFinite(result)) {
            throw new Error("ç„¡æ•ˆè¨ˆç®—");
        }
        
        calcVal = String(result);
    } catch {
        calcVal = "éŒ¯èª¤";
    }
    updateCalc();
}

function clearCalc() {
    calcVal = "0";
    updateCalc();
}

function updateCalc() {
    document.getElementById("calcDisplay").value = calcVal;
}

// =====================
// ğŸš€ åˆå§‹åŒ–
// =====================
document.addEventListener('DOMContentLoaded', function() {
    // åˆå§‹è¼‰å…¥
    loadBanner();
    
    // æ¯30ç§’æ›´æ–°ä¸€æ¬¡åƒ¹æ ¼
    setInterval(loadBanner, 30000);
    
    // æŒ‰ Enter éµè§¸ç™¼è½‰æ›
    document.getElementById('amount').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            convert();
        }
    });
    
    // åˆ‡æ›è²¨å¹£æ™‚è‡ªå‹•è½‰æ›
    document.getElementById('fromCurrency').addEventListener('change', convert);
    document.getElementById('toCurrency').addEventListener('change', convert);
});
</script>
</body>
</html>
